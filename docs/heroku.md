# Memory Jogger Heroku Deployment

## rgardner's Deployment

Memory Jogger was deployed to [Heroku](https://www.heroku.com/) via [Heroku
Container
Registry](https://devcenter.heroku.com/articles/container-registry-and-runtime)
on every commit to `master` using [GitHub
Actions](https://github.com/features/actions).

Continuous Deployment via GitHub Actions was initially set up by following
[this article](https://github.com/features/actions).

The `HEROKU_API_KEY` GitHub secret can be generated by running `heroku
authorizations:create` locally.

## Deploying Your Own Memory Jogger Server

To create the Memory Jogger app on Heroku, use this button:

[![Deploy](https://www.herokucdn.com/deploy/button.svg)][deploy]

[deploy]: https://heroku.com/deploy?template=https://github.com/rgardner/memory-jogger

The only config variable you need to set is
`MEMORY_JOGGER_POCKET_CONSUMER_KEY`, which can be obtained by creating an
application in the [Pocket Developer
Portal](https://getpocket.com/developer/apps/):

- Permissions: Retrieve
- Platforms: Desktop (other)

To send emails, see the "Email Setup" section of the [README](../README.md).

Once the app has been created, deploy the code using [Heroku Container
Registry](https://devcenter.heroku.com/articles/container-registry-and-runtime):

```sh
HEROKU_APP_NAME=<YOUR_HEROKU_APP_NAME> invoke deploy
```

Once the app has been deployed, create a user and set their Pocket access token:

```sh
$ heroku run bash
Running bash on <YOUR_HEROKU_APP_NAME>...
$ memory_jogger pocket auth
Follow URL to authorize application: https://getpocket.com/auth/authorize?request_token=<redacted_request_token>&redirect_uri=memory_jogger%3Afinishauth
Press enter to continue

<redacted_user_access_token>
$ memory_jogger db user add --email <your_email> --pocket-access-token <redacted_user_access_token>
id: 1
```

Finally, set up a [Heroku
Scheduler](https://devcenter.heroku.com/articles/scheduler) job to
periodically send emails:
https://dashboard.heroku.com/apps/<YOUR_HEROKU_APP_NAME>/scheduler:

- Job: `RUST_BACKTRACE=1 memory_jogger relevant --user-id <user_id, 1 above> --email --from-email <from_email_address>`
